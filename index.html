
<!DOCTYPE html>
<html>
<head>
    <title>YouTube Playlist</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        /* Add your CSS styles here */
    </style>
</head>
<body>
    <h1>My YouTube Playlist</h1>
    <div id="playlist-container">
        <h2 id="playlist-title"></h2>
        <p id="playlist-description"></p>
        <ul id="video-list"></ul> 
    </div>
    <div id="video-container">
        <p>Click on a video to play it here:</p>
        <iframe id="video-iframe" width="640" height="360" src="" frameborder="0" allowfullscreen></iframe>
    </div>
    <script>
        async function fetchPlaylistData() {
            try {
                const response = await axios.get('http://localhost:5000/playlist');
                const { details, items } = response.data;
                displayPlaylist(details, items);
            } catch (error) {
                console.error("Error fetching playlist data:", error);
                // Display error message on the page
            }
        }

        function displayPlaylist(details, items) {
            const playlistTitle = document.getElementById("playlist-title");
            const playlistDescription = document.getElementById("playlist-description");
            const videoList = document.getElementById("video-list");

            playlistTitle.textContent = details.title;
            playlistDescription.textContent = details.description;

            items.forEach(item => {
                const listItem = document.createElement("li");
                const videoLink = document.createElement("a");
                videoLink.href = `https://www.youtube.com/watch?v=${item.snippet.resourceId.videoId}`;
                videoLink.textContent = item.snippet.title;
                videoLink.target = "_blank"; 
                videoLink.addEventListener('click', onVideoClick);

                // Create checkbox and add event listener
                const checkbox = document.createElement("input");
                checkbox.type = "checkbox";
                checkbox.id = `checkbox-${item.snippet.resourceId.videoId}`;
                checkbox.addEventListener("change", toggleWatched);

                // Load watched status from localStorage and set checkbox state
                const watched = localStorage.getItem(`watched-${item.snippet.resourceId.videoId}`) === "true";
                checkbox.checked = watched;

                listItem.appendChild(checkbox); // Add checkbox before the link
                listItem.appendChild(videoLink);
                videoList.appendChild(listItem);
            });
        }

        function onVideoClick(event) {
            event.preventDefault(); 
            const videoId = event.target.href.split('v=')[1];
            const iframe = document.getElementById("video-iframe");
            iframe.src = `https://www.youtube.com/embed/${videoId}`;
        }

        function toggleWatched(event) {
            const checkbox = event.target;
            const videoId = checkbox.id.replace("checkbox-", ""); 
            localStorage.setItem(`watched-${videoId}`, checkbox.checked);
        }

        fetchPlaylistData(); 
    </script>
</body>
</html>